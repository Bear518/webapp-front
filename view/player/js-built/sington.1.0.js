define(["./common","jquery","./controller/controller","./utils/helpers","components/slider","text!../templates/video_controlbar.html","text!../templates/controlbar.html","utils/ui","utils/storage"],function(e,t,i,l,r,s,n,a,o){if(!t)return void console.log(t);var c=new o,d=t("#J_prismPlayer"),m={loadProvider:function(e,t){for(var i in e)/script/.test(i)&&l.loadScript(e[i],t),/link/.test(i)&&l.loadStyle(e[i])},setup:function(){var e=new prismplayer({id:"J_prismPlayer",source:"http://res.skillbridge.cn/video/dkx1.mp4",autoplay:!1,width:"100%",height:"530px",showBarTime:"116000",skinLayout:[{name:"bigPlayButton",align:"blabs",x:30,y:80},{name:"controlBar",align:"blabs",x:0,y:0,children:[{name:"progress",align:"tlabs",x:0,y:0},{name:"playButton",align:"tlabs",x:20,y:25},{name:"timeDisplay",align:"tlabs",x:100,y:23},{name:"volume",align:"trabs",x:323,y:23},{name:"fullScreenButton",align:"trabs",x:116,y:23}]}]}),o=document.getElementById("J_clickToPlay");o.addEventListener("click",function(t){e.loadByUrl("http://res.skillbridge.cn/video/dkx1.mp4",20)});var m=document.getElementById("J_prismPlayer");if(m.addEventListener("mouseover",function(e){t(".prism-controlbar").show()}),e.on("pause",function(){}),e.on("uiReady",function(){console.log("uiReady")}),0==this.providerType){t(".prism-volume").css("right","405px");var v=t(".prism-controlbar");v.append(s);var u=new r(t(".j_volume_slider")[0],"jx-volume-slider","horizontal"),p=new i(e);new a(t(".hd-select-wrap")[0]).on("click",function(e){l.log("hd select evt",e);var i=t(e.target),r=i.html();i.siblings().removeClass("active"),i.addClass("active"),l.log("switch hd video source"),p.loadByUrl("http://res.skillbridge.cn/video/dkx1.mp4",20),t(".hd-selected").html(r)}),new a(t(".provider-select-wrap")[0]).on("click",function(e){l.log("player select evt",e);var i=t(e.target),r=i.data("type");c.setItem("providerType",r),window.location.reload()}),new a(t(".rate-select-wrap")[0]).on("click",function(e){l.log("rate select evt",e);var i=t(e.target),r=i.data("rate"),s=i.html();i.siblings().removeClass("active"),i.addClass("active"),l.log("change rate to ",r);var n=p.getPlaybackRate();l.log("current video rate is",n),p.setPlaybackRate(r),t(".rate-selected").html(s)});this.volumeSlider=u,this.volumeSlider.on("update",function(e){l.log("volume update",e),p.setVolume(e.percentage);var i=Math.round(e.percentage);c.setItem("volume",i),t(".j_volume_slider").find(".title").html(i+"%").css("visibility","visible");var r=setTimeout(function(){t(".j_volume_slider").find(".title").css("visibility","hidden"),clearInterval(r)},1e3)})}else 1==this.providerType&&(d.append(n),new a(t(".provider-select-wrap")[0]).on("click",function(e){l.log("player select evt",e);var i=t(e.target),r=i.data("type");c.setItem("providerType",r),window.location.reload()}))},changeVolume:function(e){this.elementThumb=this.elementThumb||this.$volume_container.find(".knob")[0],this.elementProgress=this.elementProgress||this.$volume_container.find(".progress")[0],e=Math.max(0,Math.min(e,100)),this.elementThumb.style.bottom=e+"%",this.elementProgress.style.height=e+"%"},bindEvents:function(){var e=this;this.$container=d,this.$volume_container=d.find(".j_volume_slider"),this.elementRail=d.find(".slider-wrap"),t("#J_prismPlayer").on("click",".prism-volume",function(i){if(/prism-volume mute/.test(i.target.className))e.volumeSlider.render(0),t(".prism-volume").addClass("mute");else{t(".prism-volume").removeClass("mute"),console.log("prism-volume click");var l=c.getItem("volume")||50;e.volumeSlider.render(l)}}),t("#J_prismPlayer").on("click",".jx-btn-fullbrowser",function(e){d.toggleClass("jx-size jx-flag-fullscreen")}),t(window).resize(function(){l.log("resize")})},activePlayerSelectedEl:function(e){var i=t(".provider-select-wrap");i.find(".active").removeClass("active"),i.find("li").eq(e).addClass("active")},init:function(){var e=c.getItem("providerType")||0,t=[{name:"html5",script:"/view/player/1.4.10/prism-h5.js",link:"/view/player/css/1.4.10/skins/default/index.css"},{name:"flash",script:"//g.alicdn.com/de/prismplayer/1.4.10/prism-flash.js"}],i=t[e];this.loadProvider(i,function(){l.setup(),l.bindEvents(),l.activePlayerSelectedEl(e)}),this.providerType=e;var l=this}};m.init()});