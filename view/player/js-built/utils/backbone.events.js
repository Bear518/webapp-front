define(["utils/underscore"],function(t){var e=[],n=e.slice,r={on:function(t,e,n){if(!s(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n}),this},once:function(e,n,r){if(!s(this,"once",e,[n,r])||!n)return this;var i=this,c=t.once(function(){i.off(e,c),n.apply(this,arguments)});return c._callback=n,this.on(e,c,r)},off:function(e,n,r){var i,c,l,a,h,o,f,u;if(!this._events||!s(this,"off",e,[n,r]))return this;if(!e&&!n&&!r)return this._events=void 0,this;for(a=e?[e]:t.keys(this._events),h=0,o=a.length;h<o;h++)if(e=a[h],l=this._events[e]){if(this._events[e]=i=[],n||r)for(f=0,u=l.length;f<u;f++)c=l[f],(n&&n!==c.callback&&n!==c.callback._callback||r&&r!==c.context)&&i.push(c);i.length||delete this._events[e]}return this},trigger:function(t){if(!this._events)return this;var e=n.call(arguments,1);if(!s(this,"trigger",t,e))return this;var r=this._events[t],i=this._events.all;return r&&c(r,e,this),i&&c(i,arguments,this),this},triggerSafe:function(t){if(!this._events)return this;var e=n.call(arguments,1);if(!s(this,"trigger",t,e))return this;var r=this._events[t],i=this._events.all;return r&&l(r,e,this,t),i&&l(i,arguments,this,t),this}},i=/\s+/,s=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var s in n)t[e].apply(t,[s,n[s]].concat(r));return!1}if(i.test(n)){for(var c=n.split(i),l=0,a=c.length;l<a;l++)t[e].apply(t,[c[l]].concat(r));return!1}return!0},c=function(t,e,n){var r,i=-1,s=t.length,c=e[0],l=e[1],a=e[2];switch(e.length){case 0:for(;++i<s;)(r=t[i]).callback.call(r.context||n);return;case 1:for(;++i<s;)(r=t[i]).callback.call(r.context||n,c);return;case 2:for(;++i<s;)(r=t[i]).callback.call(r.context||n,c,l);return;case 3:for(;++i<s;)(r=t[i]).callback.call(r.context||n,c,l,a);return;default:for(;++i<s;)(r=t[i]).callback.apply(r.context||n,e);return}},l=function(t,e,n,r){for(var i,s=-1,c=t.length;++s<c;)try{(i=t[s]).callback.apply(i.context||n,e)}catch(t){console.log('Error in "'+r+'" event handler:',t)}};return r});