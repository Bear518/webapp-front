define(["utils/helpers","text!templates/rightclick.html","utils/underscore","utils/ui"],function(e,t,i,n){var s=function(){};return i.extend(s.prototype,{buildArray:function(){var e=new Date;e.setTime(e.getTime()-6e4*e.getTimezoneOffset());var t="local."+e.toISOString().replace(/[\.\-:T]/g,"-").replace(/Z|\.\d/g,""),i="1.1.0+"+t,n=i.split("+"),s=n[0],r={items:[{title:"Powered by JW Player "+s,featured:!0,showLogo:!0,link:"https://jwplayer.com/learn-more"}]},l=s.indexOf("-")>0,h=n[1];if(l&&h){var o=h.split(".");r.items.push({title:"build: ("+o[0]+"."+o[1]+")",link:"#"})}return r},buildMenu:function(){this.buildArray();return e.createElement(t)},updateHtml:function(){this.el.innerHTML=this.buildMenu().innerHTML},rightClick:function(e){return this.lazySetup(),!this.mouseOverContext&&(this.hideMenu(),this.showMenu(e),!1)},getOffset:function(e){for(var t=e.target,i=e.offsetX||e.layerX,n=e.offsetY||e.layerY;t!==this.playerElement;)i+=t.offsetLeft,n+=t.offsetTop,t=t.parentNode;return{x:i,y:n}},showMenu:function(t){var i=this.getOffset(t);return this.el.style.left=i.x+"px",this.el.style.top=i.y+"px",e.addClass(this.playerElement,"js-flag-rightclick-open"),clearTimeout(this._menuTimeout),this._menuTimeout=setTimeout(this.hideMenu.bind(this),3e3),!1},hideMenu:function(){return this.elementUI.off("out",this.hideMenu,this),this.mouseOverContext?void this.elementUI.on("out",this.hideMenu,this):void e.removeClass(this.playerElement,"js-flag-rightclick-open")},lazySetup:function(){this.el||(this.el=this.buildMenu(),this.layer.appendChild(this.el),this.hideMenuHandler=this.hideMenu.bind(this),this.addOffListener(this.playerElement),this.addOffListener(document),this.elementUI=new n(this.el,{useHover:!0}).on("over",function(){this.mouseOverContext=!0},this).on("out",function(){this.mouseOverContext=!1},this))},setup:function(e,t,i){this.playerElement=t,this.model=e,this.mouseOverContext=!1,this.layer=i,t.oncontextmenu=this.rightClick.bind(this)},addOffListener:function(e){e.addEventListener("mousedown",this.hideMenuHandler),e.addEventListener("touchstart",this.hideMenuHandler),e.addEventListener("pointerdown",this.hideMenuHandler)},removeOffListener:function(e){e.removeEventListener("mousedown",this.hideMenuHandler),e.removeEventListener("touchstart",this.hideMenuHandler),e.removeEventListener("pointerdown",this.hideMenuHandler)},destroy:function(){clearTimeout(this._menuTimeout),this.el&&(this.hideMenu(),this.elementUI.off(),this.removeOffListener(this.playerElement),this.removeOffListener(document),this.hideMenuHandler=null,this.el=null),this.playerElement&&(this.playerElement.oncontextmenu=null,this.playerElement=null),this.model&&(this.model.off("change:provider",this.updateHtml),this.model=null)}}),s});