<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>全部课程_IT/互联网|影视动漫|金融会计|职场能力_极视教育网</title>
    <meta name="description" content="极视教育作为中国领先的游戏职业在线教育平台之一,国内第一家专注于游戏职业培训与发展的在线 教育平台。平台致力于构建“学习+实战+机遇”三元结构闭环的模式，携手企业与名师一 起帮助有职业培训需求的人才，并为企业提供人才储备的解决方案,拥有海量高清职业课程,涵盖20+个技术领域,如Android,iOS ,Unity3D,Java,Photoshop,Maya,3D MAX,独立游戏等视频教程.根据在线学习特点,极视教育推出职业图谱,帮助学习者从零基础起步,结合实战案例演练,系统学习,助你快速成为优秀技术人才！">
    <meta name="keywords" content="极视教育,职业教育,在线教育平台,在线教育,在线学习,职业培训,android,ios,Unity3D,java,Photoshop,Maya,3D MAX,独立游戏">
    <meta name="viewport" content="width=device-width">

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <!-- <link rel="stylesheet" href="css/normalize.css"> -->
    <link rel="stylesheet" href="/css/main.css">
    <style type="text/css">
        .midden-tab-menu .animation {transition: height .5s ease-out;-moz-transition: height .5s ease-out;-webkit-transition: height .5s ease-out;-o-transition: height .5s ease-out;transform-origin: center;-webkit-transform-origin: center;-ms-transform-origin: center;-moz-transform-origin: center;}
        .content-wrap *{box-sizing:border-box;-moz-box-sizing:border-box; /* Firefox */-webkit-box-sizing:border-box; /* Safari */}
        .content-wrap{margin:0 auto;width: 1200px;}
        .top-img-wrap{height: 200px;line-height: 200px;font-size: 38px;color: #fff;background: url('/img/info/setinfo/top-img-bg.png') no-repeat center center;background-size: cover;margin-bottom: 12px;}
        .midden-tab-menu ul{border-bottom: 1px solid #cecece;font-size: 16px;margin-bottom: 32px;}
        .midden-tab-menu ul>li{width: 66px;height: 46px;line-height: 46px;margin:0 50px 0 20px;text-align: center;}
        .midden-tab-menu ul>li.active{border-bottom: 3px solid #ff9001;color: #ff9001;height: 46px;}
        .midden-tab-menu ul>li.active a{color: #ff9001;}
        .midden-tab-menu ul>li:hover{border-bottom: 3px solid #ff9001;color: #ff9001;height: 46px;}
        .midden-tab-menu ul>li:hover a{color: #ff9001;}
        .midden-tab-menu ul>li:last-child{width: 80px;}
        .edit-wrap{height: 710px;background: #fffdf7;box-shadow: 0 5px 6px 5px rgba(0,0,0,0.1);-moz-box-shadow: 0 5px 6px 2px rgba(0,0,0,0.1);margin-bottom: 90px;padding:42px 172px;}
         input,select{border:1px solid #cecece;height: 36px;vertical-align: middle;color: #999;font-size: 12px;border-radius:3px;}
        .edit-wrap input[type='text'],.edit-wrap select{padding-left: 15px;}
        .edit-wrap textarea{border:1px solid #cecece;height: 136px;resize:none;padding: 15px;color: #999;font: 12px "Microsoft Yahei",arial,tahoma,MS Gothic,sans-serif;}
        .w430{width: 430px;}.w108{width: 108px;}
        .btn-save{width: 110px;height: 36px;background: #ff9001;color: #fff;text-align: center;border:1px solid #ff9001;cursor: pointer;}
        .edit-wrap .name-wrap{height: 36px;line-height: 36px;width: 85px;}
        .edit-wrap ul>li{margin-bottom: 25px;}
        .mrg-t25{margin-top: 25px;}.mrg-l52{margin-left: 52px;}.mrg-r8{margin-right: 8px;}.mrg-l85{margin-left: 85px;}
        .edit-wrap .sex-select-wrap{color: #333;}
        .edit-wrap .birthday-wrap span{margin: 0 9px;}
        /*头像设置这一块*/
        .edit-wrap .set-photo-wrap {margin-left: 142px;}
        .edit-wrap .set-photo-wrap .img-wrap{width: 180px;height: 180px;overflow: hidden;background: #eee;}
        .edit-wrap .img-wrap img{width: 100%;height: 100%;}
        .edit-wrap .btn-upload{color: #333;width: 86px;height: 38px;cursor: pointer;background: inherit;}
        .edit-wrap .upload-file{cursor: pointer;}
        .edit-wrap .upload-btn-wrap:hover .btn-upload{background: #f6f6f6;}
        .edit-wrap .i-icon{background: url('/img/info/setinfo/icon.png') no-repeat;display: inline-block;vertical-align: middle;}
        .edit-wrap .i-switch{background-position: -7px 5px;height: 48px;}
        .edit-wrap .photo-switch-wrap{height: 58px;color: #999;padding-top: 6px;}
        /*.edit-wrap .photo-switch-wrap:hover .i-switch{background-position: -36px 5px;}*/
        /*头像设置这一块*/
        /*err span style*/
        .edit-wrap .r-wrap{position: relative;}
        .err{background-color: #db8a83;color: #fff;font-weight: normal;height: 24px;right: 10px;line-height: 24px;padding-right: 10px;position: absolute;top: 6px;padding: 0 7px;float: left;display: none;}
        .err-text{margin-right: 17px;color: #db8a83;display: none;}
        .upload-btn-wrap{position: relative;}
        .upload-file{position: absolute;width: 86px;height: 38px;top:0;right: 0;opacity: 0;}
        /*err span style*/

    </style>
</head>
<body>
<div class="" include="/view/module/header.html"></div>
<div class="top-img-wrap">
    <div class="content-wrap">个人设置</div>
</div>
<div class="content-wrap">
    <div class="midden-tab-menu"><ul class="clearfix"><li class="f-l active animation"><a href="/view/info/setinfo.html">个人信息</a></li><li class="f-l animation"><a href="/view/info/account_safe.html">账户安全</a></li><li class="f-l animation"><a href="/view/info/th_bind.html">绑定第三方</a></li></ul></div>
    <div id="j_info_wrap"  class="edit-wrap clearfix">
        <div class="f-l">
            <ul class="">
                    <li class="clearfix">
                            <div class="f-l name-wrap">昵称：</div>
                            <div class="f-l r-wrap">
                                    <!-- <span id="j_info_name_sp" class="default"></span> -->
                                    <input class="edit input-txt w430 j_nickname" type="text" value="" placeholder="请输入你的昵称">
                                    <span class="err j_nickname_err"></span>
                            </div>
                            <div class="f-l"><!-- <span id="j_info_name_error_sp" class="edit require-star">*</span> --></div>
                    </li>
                    <li class="clearfix">
                            <div class="f-l name-wrap">性别：</div>
                            <div class="f-l r-wrap">
                                    <!-- <span id="j_info_sex_sp" class="default"></span> -->
                                    <div class="edit sex-select-wrap w430 clearfix">
                                            <span class="sex-option"><input id="j_info_sex_m" type="radio" class="mrg-r8 male" name="sex" value="M">男</span>
                                            <span class="sex-option"><input id="j_info_sex_f" type="radio" class="sex-radio mrg-r8 mrg-l52 female" name="sex" value="F">女</span>
                                            <span class="sex-option"><input id="j_info_sex_s" type="radio" class="sex-radio mrg-r8 mrg-l52 other" name="sex" value="S">保密</span>
                                            <span class="err-text f-r j_gender_err"></span>
                                    </div>
                            </div>
                             <div class="f-l"><!-- <span id="j_info_sex_error_sp" class="edit require-star">*</span> --></div>
                    </li>
                    <li class="clearfix">
                            <div class="f-l name-wrap">生日：</div>
                            <div class="f-l r-wrap">
                                    <!-- <span id="j_info_bd_sp" class="default"></span> -->
                                    <div class="edit birthday-wrap">
                                            <!-- <input type="text" maxlength="4" class="w108 j_year"> -->
                                            <select class="w108 j_year"><option>请选择</option></select>
                                            <span>年</span>
                                            <!-- <input type="text" maxlength="2" class="w108 j_month"> -->
                                            <select class="w108 j_month"><option>请选择</option></select>
                                            <span>月</span>
                                            <!-- <input type="text" maxlength="2" class="w108 j_day"> -->
                                            <select class="w108 j_day"><option>请选择</option></select>
                                            <span>日</span>
                                    </div>
                            </div>
                    </li>
                    <li class="clearfix">
                            <div class="f-l name-wrap">个人状态：</div>
                            <div class="f-l r-wrap">
                                    <!-- <span id="j_info_st_sp" class="default"></span> -->
                                    <div class="edit">
                                            <select class="state w430 j_personal_state">
                                                    <option>请选择</option>
                                                    <option>学生</option>
                                                    <option>在职</option>
                                                    <option>待业</option>
                                            </select>
                                    </div>
                            </div>
                    </li>
                    <li class="clearfix">
                            <div class="f-l name-wrap">专业：</div>
                            <div class="f-l r-wrap">
                                    <!-- <span id="j_info_st_sp" class="default"></span> -->
                                    <div class="edit">
                                            <select class="state w430 j_major">
                                            </select>
                                    </div>
                            </div>
                    </li>
                    <li class="clearfix">
                            <div class="f-l name-wrap">现居地：</div>
                            <div class="f-l r-wrap">
                                    <!-- <span id="j_info_address_sp" class="default"></span> -->
                                    <div class="edit"><input placeholder="请输入你的居住地" class="input-txt w430 j_address" type="text"></div>
                            </div>
                    </li>
                    <li class="clearfix">
                            <div class="f-l name-wrap">个性签名：</div>
                            <div class="f-l w298 r-wrap">
                                    <p id="j_info_intro_sp" class="default"></p>
                                    <textarea placeholder="最多可输入150个字" maxlength="150" class="edit w430 j_intro"></textarea>
                            </div>
                    </li>
                    <li class="edit"> <div><input id="j_btn_update_info" type="button" class="but-sure btn btn-save mrg-l85" value="保存"></div></li>
            </ul>
        </div>
        <div class="f-l set-photo-wrap">
            <form action="/skillbridge-customer/user/updateIcon" id="uploadPhotoForm" enctype="multipart/form-data" method="post" target="ajaxifr">
                <div class="img-wrap"><img data-index="1" class="photo j_photo j_user_photo" src=""></div>
                <div class="photo-switch-wrap">

                    支持jpg、png、bmp格式的<br>
                    图片，文件建议小于10M
                </div>
                <div class="upload-btn-wrap">
                    <input type="button" class="btn-upload j_switch_photo_btn" value="换一张">
                    <input type="button" class="btn-upload j_btn_upload" value="上传头像">
                    <input id="j_upload_photo" name="file" accept="image/jpeg, image/png, image/bmp" type="file" class="upload-file" onchange="setInfoModule.uploadFile(this)"> 
                </div>

            </form>
        </div>
    </div>
</div>
<div include="../module/footer.html"></div>
<iframe name="ajaxifr" style="display: none;"></iframe>
<script src="/js/vendor/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<script type="text/javascript">
    var setInfoModule={
        bindEvents:function(){
            var self=this;
            $('#j_info_wrap').on('click','.sex-option',function(){
                var $this=$(this);
                $('.j_sex_selected').removeClass('j_sex_selected');
                $this.addClass('j_sex_selected');
                $this.find('input').prop('checked',true);
            });
            $('#j_info_wrap').on('click','#j_btn_update_info',function(){
                mainModule.disableBtn($(this));
                var info=self.getInputData();
                mainModule.log('要保存的user data',info);
                // return;
                self.updateUserInfo(info,function(result){
                    console.log(result);
                    mainModule.showGlobalHintBar('修改成功!');
                    if(result.code=='SUCCESS'){
                        mainModule.showGlobalHintBar('已成功获得7天VIP!');
                    }
                    $('.j_nickname_err').hide();
                    $('.j_gender_err').hide();
                },function(result){
                    mainModule.log('修改个人信息错误',result);
                    for(var i=0,len=result.content.length;i<len;i++){
                        var content=result.content[i];
                        switch(content.field){
                            case 'nickname':
                                $('.j_nickname_err').html(content.message).show();
                            break;
                            case 'gender':
                                $('.j_gender_err').html(content.message).show();
                            break;
                        }
                    }
                    if(!result.content){
                        mainModule.showGlobalHintBar(result.message+' 请稍后再试！');
                    }
                });
            });
            $('#j_info_wrap').on('click','.j_switch_photo_btn',function(){
                var $img=$('.j_photo'),index=$img.data('index'),src;
                
                if(index>6){
                    index=0;
                }
                src='/img/info/setinfo/'+(++index)+'.png';
                $img.attr('src',src).data('index',index);
                mainModule.setCookie('photo',src,true);
                $('.j_user_photo').attr('src',src);
            });
            $('#j_info_wrap').on('focus','input',function(){
                var $this=$(this);
                self.inputBlurHide($this);
            });
            // $('#j_info_wrap').on('blur','input',function(){
            //     var $this=$(this);
            //     self.inputFocusShow($this);
            // })
        },
        getInputData:function(){
            var $wrap=$('#j_info_wrap');
            var data={nickname:$wrap.find('.j_nickname').val(),
                    gender:$wrap.find('.j_sex_selected').find('input').val(),
                    birthY:$wrap.find('.j_year').val(),
                    birthM:$wrap.find('.j_month').val(),
                    birthD:$wrap.find('.j_day').val(),
                    situation:$wrap.find('.j_personal_state').val(),
                    major:$wrap.find('.j_major')[0].value,
                    address:$wrap.find('.j_address').val(),
                    introduce:$wrap.find('.j_intro').val()};
            for(var key in data){
                if(!data[key]&&data[key]!=''||/请选择/.test(data[key])){
                    delete data[key];
                }
            }
            data.nickname&&(data.nickname=mainModule.htmlEscape(data.nickname));
            var birthY=data.birthY,birthM=data.birthM,birthD=data.birthD;
            if(birthY&&birthM&&birthD){
                if(birthY&&birthM&&(birthM=parseInt(birthM))<10){
                    birthM='0'+birthM;
                }
                if(birthY&&birthM&&birthD&&(birthD=parseInt(birthD))<10){
                    birthD='0'+birthD;
                }
                var birthdate=birthY+'-'+birthM+'-'+birthD;
                if(!isNaN(new Date(birthdate))){
                    // data.birthdate=Date.parse(new Date(birthdate));
                    data.birthdate=birthdate;

                }
                
            }
            return data;
        },
        renderUserInfo:function(result){
            var $wrap=$('#j_info_wrap');
            $wrap.find('.j_nickname').val(result.nickname||'');
            if(result.gender){
                var $sex_radio=$wrap.find('#j_info_sex_'+result.gender.toLowerCase());
                $sex_radio.prop('checked',true);
                $sex_radio.parent().addClass('j_sex_selected');
            }
            if(result.birthdate){
                result.birthdate=new Date(result.birthdate);
                $wrap.find('.j_year').val(result.birthdate.getFullYear());
                $wrap.find('.j_month').val(result.birthdate.getMonth()+1);
                $wrap.find('.j_day').val(result.birthdate.getDate());
            }
            var photo=result.icon||mainModule.getCookie('photo')||'/img/info/setinfo/1.png';
            $wrap.find('.j_photo').attr('src',photo);
            $wrap.find('.j_personal_state').val(result.situation||'请选择');
            setInfoModule.majorSelected();
            $wrap.find('.j_address').val(result.address);
            $wrap.find('.j_intro').val(result.introduce);
        },
        updateUserInfo:function(info,succFunc,errFunc){
            var self=this;
            $.ajax({
                type:'post',
                data:info,
                url:mainModule.uri.updateUserInfo,
                success:function(result){
                    mainModule.httpInterceptor(result,succFunc,errFunc);
                }
            })
        },
        getUserInfo:function(){
            var self=this;
            $.ajax({
                type:'get',
                url:mainModule.uri.getUserInfo,
                success:function(result){
                    mainModule.log('我的个人信息',result);
                    if(result.status=='SUCCESS'){

                    }else{
                        
                    }
                }
            })
        },
        uploadFile:function(file){
            // Get a reference to the fileList
            var files = !!file.files ? file.files : [];
            // If no files were selected, or no FileReader support, return
            if (!files.length || !window.FileReader) return;
              var fileType=files[0].type;
                // Create a new instance of the FileReader
                var reader = new FileReader();

                // Read the local file as a DataURL
                reader.readAsDataURL(files[0]);
              console.info(files[0]);

                // When loaded, set image data as background of div
                reader.onloadend = function(){
                  $(".j_photo").attr("src",this.result);
                  console.log(fileType);
                  $('#uploadPhotoForm').submit();
                  $('.j_btn_upload').val('上传中...').prop('disabled',true);
                  // saveFile(fileType,this.result);
                 var si=setInterval(function(){
                      var result=JSON.parse(window.frames['ajaxifr'].document.body.children[0].innerHTML||{});
                      if(result.status=='SUCCESS'){
                          mainModule.setCookie('photo',result.content);
                          $('.j_user_photo').attr('src',result.content);
                          $('.j_btn_upload').val('上传头像').prop('disabled',false);
                          mainModule.showGlobalHintBar('头像修改成功!');
                          clearInterval(si);
                      } else if(result.status){
                        $('.j_btn_upload').val('上传头像').prop('disabled',false);
                        mainModule.showGlobalHintBar('出错啦！');
                        clearInterval(si);
                      }
                      mainModule.log('修改头像接口返回信息',window.frames['ajaxifr'].document.body.innerHTML);
                  },1000);
              }
        },
        getMajorList:function(){
            // var str='国际经济与贸易、市场营销、财政学、法学、对外汉语、雕塑、表演、播音与主持艺术、广播电视编导、艺术设计、戏剧影视美术设计、摄影、动画、应用物理学、天文学、应用气象学、海洋科学、电子信息科学与技术、光信息科学与技术、环境科学、应用心理学、高分子材料与工程、热能与动力工程、电子信息工程、通信工程、生物医学与工程、城市规划、环境工程、制药工程、食品科学与工程、轻化工程、服装设计与工程、生物工程、农业电气化与自动化、园艺、水产养殖学、海洋渔业科学与技术、预防医学、口腔医学、护理学、信息管理与信息系统、工程管理、财务管理、人力资源管理、劳动与社会保障、农村区域发展、金融学、国际政治、外交学、治安学、边防管理、广播电视新闻学、广告学、编辑出版学、舞蹈编导、数学与应用数学、信息与计算科学、应用化学、资源环境与城乡规划管理、生态学、统计学、勘察技术与工程、无机非金属材料工程、机械设计制造及其自动化、材料成型与控制工程、自动化、计算机科学与技术、土木工程、港口航道与海岸工程、测绘工程、安全工程、交通工程、给水排水工程、水利水电工程、飞行技术、航海技术、包装工程、刑事科学技术、消防工程、草业科学、动物科学、麻醉学、医学检验、中医学、针灸推拿学、法医学、中药学、药物制剂';
            // return str.split('、');
            var self=this;
            $.ajax({
                type:'get',
                data:{code:'PER_MAJOR'},
                url:mainModule.uri.getByCode,
                success:function(result){
                    mainModule.log('专业数据字典',result);
                    mainModule.httpInterceptor(result,self.renderMajorSelect);
                }
            })
        },
        majorSelected:function(){
            if(mainModule.userInfo){
                var result=mainModule.userInfo;
                var $wrap=$('#j_info_wrap');
                $wrap.find('.j_major')[0].value=result.major||'请选择';
            }
        },
        renderMajorSelect:function(result){
            // var result=this.getMajorList();
            var dom='<option value="请选择">请选择</option>';
            for(var i=0,ii=result.length;i<ii;i++){
                var item=result[i];
                dom+='<option value="'+item.code+'">'+item.name+'</option>';
            }
            $('.j_major').html(dom);
            setInfoModule.majorSelected();
        },
        inputBlurHide:function($input){
            var $err=$input.next('.err'),val=$err.html();
            if(val){
                $err.hide();
            }
        },
        inputFocusShow:function($input){
            var $err=$input.next('.err'),val=$err.html();
            if(val){
                $err.show();
            }
        },
        initYearsSelectDom:function(){
            var dom='',
                year=new Date().getFullYear();
            for(var i=0;i<40;i++){
                dom+='<option>'+(year--)+'</option>';
            }
            $('.j_year').append(dom);
            this.initMonthsDom();
        },
        initMonthsDom:function(){
            var dom='',month=12;
            for(var i=0;i<12;i++){
                dom+='<option>'+(month--)+'</option>';
            }
            $('.j_month').append(dom);
            this.initDaysSelectDom();
        },
        initDaysSelectDom:function(){
            var dom='',day=31;
            for(var i=1;i<32;i++){
                dom+='<option>'+(day--)+'</option>';
            }
            $('.j_day').append(dom);
        },
        init:function(){
            this.bindEvents();
            this.getMajorList();
            this.initYearsSelectDom();
            $('#uploadPhotoForm').attr('action',mainModule.uri.updateUserPhoto);
        }
    };
    setInfoModule.init();
    console.log('setInfoModule loaded');
</script>
</body>
</html>